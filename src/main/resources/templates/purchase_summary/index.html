<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Purchase-Summary-Listing</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
	rel="stylesheet">
<link rel="stylesheet" href="/css/style.css">
<!-- Favicon / Logo -->
<link rel="icon" type="image/png" href="/images/kr.png">
</head>
<body>
	<div class="d-flex">
		<!-- Sidebar -->
		<div th:replace="fragments/sidebar :: sidebar"></div>

		<!-- Main Content -->
		<div class="content p-4 flex-grow-1">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h1 class="mb-0 text-center flex-grow-1">Purchase Summary</h1>

			</div>
			<div class="d-flex justify-content-start mt-4" style="width: 30%;">
				<a th:href="@{/purchases}" class="btn btn-primary mb-3"> <i
					class="bi bi-arrow-left me-1 "></i> Back
				</a>
			</div>

			<!-- Summary Cards -->
			<div class="row mb-3 text-center">
				<div class="col-md-4">
					<div class="alert alert-primary">
						<strong>Total Suppliers:</strong> <span th:text="${totalSupplier}">0</span>
					</div>
				</div>
				<div class="col-md-4">
					<div class="alert alert-success">
						<strong>Total Quantity:</strong> <span th:text="${totalQty}">0</span>
					</div>
				</div>
				<div class="col-md-4">
					<div class="alert alert-warning">
						<strong>Total Price ($):</strong> <span
							th:text="${totalPrice} + '$'">0.00</span>
					</div>
				</div>
			</div>

			<!-- Search by Supplier -->
			<div class="mb-3">
				<input type="text" id="supplierSearch" class="form-control"
					placeholder="Search by Supplier">
			</div>

			<div style="max-height: 450px; overflow-y: auto;">
				<!-- Purchases Table -->
				<table class="table table-bordered table-hover" id="purchaseTable">
					<thead class="table-dark"
						style="position: sticky; top: 0; z-index: 2;">
						<tr>
							<th>Purchase ID</th>
							<th>Purchase Date</th>
							<th>Quantity</th>
							<th>Product</th>
							<th>Total Amount ($)</th>
							<th>Supplier</th>
						</tr>
					</thead>
					<tbody style="font-family: 'Noto Sans Khmer', Arial, sans-serif;">
						<tr th:each="purchase : ${purchaseList}">
							<td th:text="${purchase.id}"></td>
							<td th:text="${purchase.purchase_date}"></td>
							<td th:text="${purchase.quantity}"></td>
							<td
								th:text="${purchase.product != null ? purchase.product.name : 'N/A'}"></td>
							<td th:text="${purchase.total_amount}"></td>
							<td
								th:text="${purchase.supplier != null ? purchase.supplier.name : 'N/A'}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<script>
    const supplierSearch = document.getElementById('supplierSearch');
    const table = document.getElementById('purchaseTable');
    const totalSuppliersSpan = document.querySelector('.alert-primary span');
    const totalQtySpan = document.querySelector('.alert-success span');
    const totalPriceSpan = document.querySelector('.alert-warning span');

    supplierSearch.addEventListener('keyup', function() {
        const filter = this.value.toLowerCase();
        const rows = table.querySelectorAll('tbody tr');

        let totalQty = 0;
        let totalPrice = 0;
        let suppliersSet = new Set();

        rows.forEach(row => {
            const supplierCell = row.cells[5];
            const supplierText = supplierCell.textContent.toLowerCase();

            if (supplierText.includes(filter)) {
                row.style.display = '';
                // Update summary data
                const qty = parseFloat(row.cells[2].textContent) || 0;
                const price = parseFloat(row.cells[4].textContent) || 0;
                totalQty += qty;
                totalPrice += price;
                if (supplierText !== 'n/a') suppliersSet.add(supplierText);
            } else {
                row.style.display = 'none';
            }
        });

        // Update summary cards
        totalSuppliersSpan.textContent = suppliersSet.size;
        totalQtySpan.textContent = totalQty;
        totalPriceSpan.textContent = totalPrice.toFixed(2);
    });
</script>

</body>
</html>
