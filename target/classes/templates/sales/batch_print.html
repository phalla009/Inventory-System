<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Batch Sales Receipt</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f8f9fa;
    color: #333;
}

@media print {
    body {
        background: white;
    }
    .no-print {
        display: none !important;
    }
    .receipt {
        border: 2px solid #333;
    }
}

.receipt {
    max-width: 800px;
    margin: 40px auto;
    padding: 30px;
    background: white;
    border: 2px solid #333;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.header {
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 3px double #333;
    padding-bottom: 15px;
}

.company-name {
    font-size: 28px;
    font-weight: bold;
    color: #2c3e50;
    margin-bottom: 5px;
}

.company-address {
    font-size: 14px;
    color: #555;
}

.receipt-title {
    font-size: 36px;
    font-weight: bold;
    color: #2c3e50;
    margin: 20px 0;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-align: center;
}

.info-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 25px;
    font-size: 15px;
}

.info-left {
    width: 55%;
}

.info-right {
    width: 40%;
    text-align: right;
}

.table {
    margin-top: 20px;
    font-size: 15px;
}

.table th {
    background-color: #345b7a !important;
    color: white;
    font-weight: 600;
    text-align: center;
}

.table td {
    vertical-align: middle;
}

.total-section {
    margin-top: 20px;
    font-size: 16px;
}

.total-line {
    display: flex;
    justify-content: flex-end;
    padding: 6px 0;
}

.total-label {
    width: 200px;
    text-align: right;
    padding-right: 20px;
}

.total-amount {
    width: 150px;
    text-align: right;
    font-weight: bold;
}

.final-total {
    border-top: 2px solid #333;
    padding-top: 8px;
    font-size: 20px;
    background-color: #f0f8ff;
}

.notes {
    margin-top: 40px;
    font-style: italic;
    color: #555;
}

.text-end {
    text-align: right;
}
</style>
</head>
<body>

<div class="container">
    <!-- Print Button -->
    <button class="btn btn-primary mb-4 mt-2 no-print" onclick="window.print()">
        <i class="bi bi-printer me-1"></i> Print Receipt
    </button>

    <!-- ONE RECEIPT FOR ALL SALES -->
    <div class="receipt">
        
        <!-- Company Header -->
        <div class="header d-flex align-items-center justify-content-center">
            <!-- Logo -->
            <div class="company-logo me-3">
                <img th:src="@{/images/kr.png}" alt="KR STORE Logo" style="height: 70px;">
            </div>

            <!-- Company info -->
            <div class="company-info">
                <div class="company-name">KR STORE.</div>
                <div class="company-address">1234 Company St., Company Town, ST 12345</div>
            </div>
        </div>

        <h1 class="receipt-title">Receipt</h1>

        <!-- Customer & Receipt Info -->
        <div class="info-row">
            <div class="info-left">
                <strong>Billed To:</strong><br>
                <span>General</span>
            </div>
            <div class="info-right">
                <strong>Receipt #</strong> 
                <span th:text="${'BATCH-' + #dates.format(#dates.createNow(), 'yyyyMMddHHmmss')}">BATCH-20251204</span><br>
                <strong>Receipt Date</strong> 
                <span th:text="${#dates.format(#dates.createNow(), 'dd-MM-yyyy')}">14-12-2025</span>
            </div>
        </div>

        <!-- Items Table - LOOP THROUGH ALL SALES -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th style="width: 15%;">QTY</th>
                    <th>Description</th>
                    <th style="width: 18%;">Unit Price</th>
                    <th style="width: 18%;">Amount</th>
                </tr>
            </thead>
            <tbody>
                <!-- LOOP EACH SALE AS A ROW -->
                <tr th:each="sale : ${selectedSales}">
                    <td th:text="${sale.quantity != null ? sale.quantity : 0}" class="text-center">1.00</td>
                    <td th:text="${sale.product != null ? sale.product.name : 'N/A'}">Product Name</td>
                    <td th:text="'$' + ${sale.subtotal != null ? #numbers.formatDecimal(sale.subtotal, 1, 2) : '0.00'}" class="text-end">$0.00</td>
                    <td th:text="'$' + ${(sale.quantity != null and sale.subtotal != null) ? #numbers.formatDecimal(sale.quantity * sale.subtotal, 1, 2) : '0.00'}" class="text-end">$0.00</td>
                </tr>
            </tbody>
        </table>

        <!-- Totals - CALCULATE GRAND TOTAL -->
        <div class="total-section">
            <!-- Subtotal -->
            <div class="total-line">
                <div class="total-label"><strong>SubTotal:</strong></div>
                <div class="total-amount">
                    <th:block th:with="subtotal=${#aggregates.sum(selectedSales.![quantity * subtotal])}">
                        <span th:text="'$' + ${#numbers.formatDecimal(subtotal, 1, 2)}">$0.00</span>
                    </th:block>
                </div>
            </div>

            <!-- Discount -->
            <div class="total-line">
                <div class="total-label"><strong>Discount (0%):</strong></div>
                <div class="total-amount">$0.00</div>
            </div>

            <!-- Total USD -->
            <div class="total-line final-total">
                <div class="total-label"><strong>Total (USD):</strong></div>
                <div class="total-amount">
                    <th:block th:with="total=${#aggregates.sum(selectedSales.![quantity * subtotal])}">
                        <span th:text="'$' + ${#numbers.formatDecimal(total, 1, 2)}">$0.00</span>
                    </th:block>
                </div>
            </div>

            <!-- Total KHR -->
            <div class="total-line final-total">
                <div class="total-label"><strong>Total (KHR):</strong></div>
                <div class="total-amount">
                    <th:block th:with="total=${#aggregates.sum(selectedSales.![quantity * subtotal])}">
                        <span th:text="${#numbers.formatDecimal(total * 4000, 0, 0)} + '៛'">0៛</span>
                    </th:block>
                </div>
            </div>
        </div>

        <div class="notes mt-5">
            <strong>Notes</strong><br>
            Thank you!
        </div>
    </div>
</div>

</body>
</html>