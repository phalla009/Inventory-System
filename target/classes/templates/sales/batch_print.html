<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>A5 Sales Receipt</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    :root {
        --primary-color: #2563eb;
        --text-dark: #1f2937;
        --border-color: #d1d5db;
    }

    /* A5 Page Setup */
    @page {
        size: A5 portrait;
        margin: 0;
    }

    body {
        font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        background: #e5e7eb;
        color: var(--text-dark);
        font-size: 13px; /* Slightly smaller for A5 */
    }

    @media print {
        body { background: white; }
        .no-print { display: none !important; }
        .receipt-container { 
            box-shadow: none !important; 
            margin: 0 !important; 
            padding: 10mm !important; /* Standard print margin */
            width: 148mm;
            height: 210mm;
        }
    }

    .receipt-container {
        width: 148mm; /* Fixed A5 Width */
        min-height: 210mm;
        margin: 20px auto;
        padding: 15mm;
        background: white;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }

    /* Branding */
    .brand-section {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid var(--text-dark);
        padding-bottom: 10px;
        margin-bottom: 15px;
    }

    .logo-area img {
        height: 50px;
    }

    .receipt-label {
        font-weight: 900;
        font-size: 24px;
        color: var(--text-dark);
        text-transform: uppercase;
    }

    /* Info Grid */
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        margin-bottom: 20px;
        line-height: 1.4;
    }

    /* Table Adjustments */
    .table {
        font-size: 12px;
        margin-bottom: 15px;
    }

    .table thead th {
        background-color: #f3f4f6 !important;
        border-top: 1px solid var(--text-dark);
        border-bottom: 1px solid var(--text-dark);
        color: #000;
        text-transform: uppercase;
    }

    /* Totals */
    .totals-area {
        margin-left: auto;
        width: 100%;
        max-width: 200px;
    }

    .total-row {
        display: flex;
        justify-content: space-between;
        padding: 3px 0;
    }

    .grand-total {
        border-top: 1px solid #000;
        margin-top: 5px;
        padding-top: 5px;
        font-weight: bold;
        font-size: 15px;
    }

    .khr-label {
        font-size: 11px;
        color: #4b5563;
        text-align: right;
        display: block;
    }

    .footer-note {
        margin-top: auto;
        padding-top: 20px;
        font-size: 11px;
        text-align: center;
        border-top: 1px dashed var(--border-color);
    }
</style>
</head>
<body>

<div class="container text-center no-print">
    <button class="btn btn-dark mt-4 mb-4" onclick="window.print()">Print A5 Receipt</button>
</div>

<div class="receipt-container">
    <div class="brand-section">
        <div class="logo-area">
            <img th:src="@{/images/kr.png}" alt="Logo">
            <div class="fw-bold">KR STORE</div>
        </div>
        <div class="receipt-label">Receipt</div>
    </div>

    <div class="info-grid">
        <div>
            <div class="text-muted small text-uppercase">Billed To</div>
            <div class="fw-bold">General Customer</div>
            <div class="small">Phnom Penh, Cambodia</div>
        </div>
        <div class="text-end">
            <div class="text-muted small text-uppercase">Receipt #</div>
            <div class="fw-bold" th:text="${'B-' + #dates.format(#dates.createNow(), 'MMddHHmm')}">B-12041230</div>
            <div class="text-muted small text-uppercase mt-1">Date</div>
            <div class="fw-bold" th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy')}">14/12/2025</div>
        </div>
    </div>

    <table class="table table-borderless">
        <thead>
            <tr>
                <th>Item Description</th>
                <th class="text-center">Qty</th>
                <th class="text-end">Total</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="sale : ${selectedSales}">
                <td>
                    <div class="fw-bold" th:text="${sale.product != null ? sale.product.name : 'N/A'}">Product Name</div>
                    <div class="small text-muted" th:text="'Unit: $' + ${#numbers.formatDecimal(sale.price, 1, 2)}">$0.00</div>
                </td>
                <td class="text-center" th:text="${sale.quantity}">1</td>
                <td class="text-end fw-bold" th:text="'$' + ${#numbers.formatDecimal(sale.quantity * sale.price, 1, 2)}">$0.00</td>
            </tr>
        </tbody>
    </table>

    <div class="totals-area">
        <div class="total-row">
            <span>Subtotal:</span>
            <th:block th:with="subtotal=${#aggregates.sum(selectedSales.![quantity * price])}">
                <span th:text="'$' + ${#numbers.formatDecimal(subtotal, 1, 2)}">$0.00</span>
            </th:block>
        </div>
        <div class="total-row">
            <span>Discount:</span>
            <th:block th:with="discountTotal=${#aggregates.sum(selectedSales.![quantity * price * (discount / 100)])}">
                <span th:text="'-$' + ${#numbers.formatDecimal(discountTotal, 1, 2)}">$0.00</span>
            </th:block>
        </div>
        <div class="total-row grand-total">
            <span>TOTAL:</span>
            <th:block th:with="grandTotal=${#aggregates.sum(selectedSales.![quantity * price * (1 - (discount / 100))])}">
                <span th:text="'$' + ${#numbers.formatDecimal(grandTotal, 1, 2)}">$0.00</span>
            </th:block>
        </div>
        <div class="text-end">
            <th:block th:with="grandTotal=${#aggregates.sum(selectedSales.![quantity * price * (1 - (discount / 100))])}">
                <span class="khr-label" th:text="${#numbers.formatDecimal(grandTotal * 4000, 0, 'COMMA', 0, 'POINT')} + ' ៛'">0 ៛</span>
            </th:block>
        </div>
    </div>

    <div class="footer-note">
        <strong>Thank you for shopping with KR STORE!</strong><br>
        Goods sold are not returnable.
    </div>
</div>

</body>
</html>